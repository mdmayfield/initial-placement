<!DOCTYPE html>
<html lang="en">

<!-- MM note to self: python -m SimpleHTTPServer 8000 in a 2nd terminal -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        const validLevels = [
            '1.0', '1.5', '2.0', '2.5', '3.0', '3.5', '4.0', '4.5', '5.0', '5.6', '6.0', '7.0', '8.0',
            '0.8', '1.3', '1.8', '2.3', '2.6', '2.7'
        ]

        $( document ).ready( initDocument );

        function initDocument() {
            $('#initial-encore-level').on('input', () => {
                calculateIPR();
                updateQuizTotal();
                updateQuizPercent();
            });

            $('#ct-1').on('input', () => calculateAvg('ct'));
            $('#ct-2').on('input', () => calculateAvg('ct'));
            $('#ct-3').on('input', () => calculateAvg('ct'));

            $('#pr-1').on('input', () => calculateAvg('pr'));
            $('#pr-2').on('input', () => calculateAvg('pr'));
            $('#pr-3').on('input', () => calculateAvg('pr'));

            $('#ht-1').on('input', () => calculateAvg('ht'));
            $('#ht-2').on('input', () => calculateAvg('ht'));
            $('#ht-3').on('input', () => calculateAvg('ht'));

            $('#quiz-correct').on('input', updateQuizPercent);
        }

        function calculateAvg(whatToAvg) {
            const av1 = Number($('#' + whatToAvg + '-1').val());
            const av2 = Number($('#' + whatToAvg + '-2').val());
            const av3 = Number($('#' + whatToAvg + '-3').val());
            const avg = $('#' + whatToAvg + '-avg');

            if (av1 === 0 || av2 === 0 || av3 === 0) {
                avg.val('Need 3 entries');
                return;
            }

            avg.val(Number((av1 + av2 + av3) / 3).toLocaleString('en-US', {maximumFractionDigits: 2}));
        }

        function recalculate() {
            //TODO
        }

        function calculateIPR() {
            const level = $('#initial-encore-level').val()
            const ipr = $('#initial-placement-range');

            if ( !validLevels.includes(level) &&
                 !validLevels.map(item => Number(item)).includes(Number(level)) ) {
                ipr.val('Need valid level');
                return;
            }

            if ( Number(level) < 3.5 ) {
                ipr.val('30 - 60');
                return;
            }
            
            if ( Number(level) < 5.6 ) {
                ipr.val('60 - 80');
                return;
            }

            if ( Number(level) < 8.0 ) {
                ipr.val('80 - 100');
                return;
            }

            ipr.val('100 - 140');
        }

        function updateQuizTotal() {
            const level = $('#initial-encore-level').val();
            const quizTotal = $('#quiz-total');

            if ( !validLevels.includes(level) &&
                 !validLevels.map(item => Number(item)).includes(Number(level)) ) {
                quizTotal.val('Need valid level');
                return;
            }

            // TODO: accommodate Idioms?
            // 0.8 - 2.7: 5 questions
            // 3.0: 7 for idioms, 5 for sequenced
            // 3.5: 7 for idioms, 6 for sequenced
            // 4.0: 7 for idioms, 7 for sequenced
            // 4.5: 7 for idioms, 7 for sequenced
            // 5.0: 7 questions
            // 5.6 and above: 9

            if (Number(level) < 3.5) {
                quizTotal.val('5');
                return;
            }
            if (Number(level) < 4.0) {
                quizTotal.val('6');
                return;
            }
            if (Number(level) < 5.6) {
                quizTotal.val('7');
                return;
            }
            quizTotal.val('9');
        }

        function updateQuizPercent() {
            const quizTotal = Number($('#quiz-total').val());
            const quizCorrect = Number($('#quiz-correct').val());
            $('#quiz-percent').val((quizTotal > 0) ? (quizCorrect / quizTotal).toLocaleString('en-US', 
                    { maximumFractionDigits: 2, style: 'percent' }) : '---' )
        }

    </script>

    <title>Initial Placement Calculator</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


</head>

<body>

<div class="container">
    <h1 class="text-center">Initial Placement Calculator</h1>
    <div class="row">
        <form id="student-info">
            <div class="form-row">
                <div class="col-md-3">
                    <label for="grade-level" class="">Grade Level</label><input type="text" class="form-control"
                        name="grade-level" maxlength="2" id="grade-level"
                        title="Student's grade, i.e. K (kindergarten), 1, 2, 3, 4, ..., A (adult)">
                </div>
                <div class="col-md-3">
                    <label for="initial-encore-level" class="">Initial Encore Level</label><input type="text"
                        class="form-control" name="initial-encore-level" maxlength="3" id="initial-encore-level"
                        title="Student's initial level in Encore (i.e. 1.0, 1.5, ...)">
                </div>
                <div class="col-md-3">
                    <label for="initial-goal" class="formbuilder-number-label">Initial Goal</label><input type="number"
                        class="form-control" name="initial-goal" value="60" min="0" max="200" step="1"
                        id="initial-goal" title="Student's initial goal, in words correct per minute">
                </div>
                <div class="col-md-3">
                    <label for="initial-placement-range" class="formbuilder-number-label">Initial Placement Range</label><input type="text"
                        class="form-control" name="initial-placement-range" id="initial-placement-range"
                        title="Student's initial placement range (calculated from initial level)" readonly disabled="disabled">
                </div>
            </div>
            <br>
            <div class="form-row">
                <div class="col-md-3">
                    <label for="ct-1" class="">Cold Timing 1st Story</label><input type="number" class="form-control"
                        name="ct-1" id="ct-1" value="60" min="0" max="500" title="Cold Timing for first story">
                </div>
                <div class="col-md-3">
                    <label for="ct-2" class="">Cold Timing 2nd Story</label><input type="number" class="form-control"
                        name="ct-2" id="ct-2" value="60" min="0" max="500" title="Cold Timing for second story">
                </div>
                <div class="col-md-3">
                    <label for="ct-3" class="">Cold Timing 3rd Story</label><input type="number" class="form-control"
                        name="ct-3" id="ct-3" value="60" min="0" max="500" title="Cold Timing for third story">
                </div>
                <div class="col-md-3">
                    <label for="ct-avg" class="formbuilder-number-label">Average Cold Timing</label><input type="text"
                        class="form-control" name="ct-avg" id="ct-avg"
                        title="Student's average cold timing (calculated from first three stories)" readonly disabled="disabled">
                </div>
            </div>
            <br>
            <div class="form-row">
                <div class="col-md-3">
                    <label for="pr-1" class=""># Practices 1st Story</label><input type="number" class="form-control"
                        name="pr-1" id="pr-1" value="5" min="0" max="500" title="Number of practices for first story">
                </div>
                <div class="col-md-3">
                    <label for="pr-2" class=""># Practices 2nd Story</label><input type="number" class="form-control"
                        name="pr-2" id="pr-2" value="5" min="0" max="500" title="Number of practices for second story">
                </div>
                <div class="col-md-3">
                    <label for="pr-3" class=""># Practices 3rd Story</label><input type="number" class="form-control"
                        name="pr-3" id="pr-3" value="5" min="0" max="500" title="Number of practices for third story">
                </div>
                <div class="col-md-3">
                    <label for="pr-avg" class="formbuilder-number-label">Average # Practices</label><input type="text"
                        class="form-control" name="pr-avg" id="pr-avg"
                        title="Student's average number of practices (calculated from first three stories)" readonly disabled="disabled">
                </div>
            </div>
            <br>
            <div class="form-row">
                <div class="col-md-3">
                    <label for="ht-1" class="">Hot Timing 1st Story</label><input type="number" class="form-control"
                        name="ht-1" id="ht-1" value="100" min="0" max="500" title="Hot Timing for first story">
                </div>
                <div class="col-md-3">
                    <label for="ht-2" class="">Hot Timing 2nd Story</label><input type="number" class="form-control"
                        name="ht-2" id="ht-2" value="100" min="0" max="500" title="Hot Timing for second story">
                </div>
                <div class="col-md-3">
                    <label for="ht-3" class="">Hot Timing 3rd Story</label><input type="number" class="form-control"
                        name="ht-3" id="ht-3" value="100" min="0" max="500" title="Hot Timing for third story">
                </div>
                <div class="col-md-3">
                    <label for="ht-avg" class="formbuilder-number-label">Average Hot Timing</label><input type="text"
                        class="form-control" name="ht-avg" id="ht-avg"
                        title="Student's average hot timing (calculated from first three stories)" readonly disabled="disabled">
                </div>
            </div>
            <br>
            <div class="form-row">
                <div class="col-md-4">
                    <label for="quiz-correct" class="">Quiz Correct Answers</label>
                    <input type="number" class="form-control" name="quiz-correct" id="quiz-correct"
                    title="Number of quiz questions the student answered correctly" value="5" min="0" max="9">
                </div>
                <div class="col-md-4">
                    <label for="quiz-total" class="">Quiz Questions in Story</label>
                    <input type="text" class="form-control" name="quiz-total" id="quiz-total"
                    title="Number of quiz questions in the level" value="" readonly disabled="disabled">
                </div>
                <div class="col-md-4">
                    <label for="quiz-percent" class="">Comprehension Percent Correct</label>
                    <input type="text" class="form-control" name="quiz-percent" id="quiz-percent"
                    title="Percent of comprehension quiz questions answered correctly" value="" readonly disabled="disabled">
                </div>
            </div>
        </form>
    </div>
</div>

</body>

</html>